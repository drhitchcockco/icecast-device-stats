<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>8K Listener Stats Widget</title>
      <link href="https://fonts.googleapis.com/css?family=Viga" rel="stylesheet"> 
      <link rel=stylesheet href="https://s3-us-west-2.amazonaws.com/colors-css/2.2.0/colors.min.css">
      <link rel="stylesheet" href="https://unpkg.com/picnic">
      <style>
        body {
            background: url(record-sleeve.jpg);
            background-size: cover;
            height: 100%;
        }
        div.listnerStatsWidget {
            width: 360px;
            height: 360px;
            position: absolute;
            padding: 24px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .inner {
            background: url('8K-circle-text.png') orange;
            background-size: cover;
            color: hsla(28, 100%, 20%, 1.0);
            font-family: 'Viga', sans-serif;
            text-align: center;
            border-radius: 50%;
            height: 100%;
        }
        .inner p {
            position: relative;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }
        span.number {
            font-size: 24px;
        }
        span.radio {
            font-size: 24px;
        }
      </style>
    </head>
    <body>
        <div class="listnerStatsWidget">
            <div id="noOfListeners" class="inner">
            </div>
        </div>

        <script>
            const endpoint = 'http://stream.8k.nz:8000/status-json.xsl';

            function getStreamStats() {
                fetch(endpoint)
                    .then(blob => blob.json())
                    .then(data => {
                        let source = data.icestats.source;
                        let numbers = source.listeners;
                        if (numbers = 0 || numbers >= 2) {
                            document.getElementById("noOfListeners").innerHTML = `
                                <p>There are currently<br>
                                <span class="number">${source.listeners} </span>
                                <span class="radio">ðŸ“»</span><br>
                                connected.
                                </p>
                                `
                        } else {
                            document.getElementById("noOfListeners").innerHTML = `
                                <p>There is currently<br>
                                <span class="number">${source.listeners} </span>
                                <span class="radio">ðŸ“»</span><br>
                                connected.
                                </p>
                                `
                        }
                    });
            }

            getStreamStats();
            setInterval(getStreamStats, 44 * 1000);
        </script>
    </body>
</html>